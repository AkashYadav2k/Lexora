import streamlit as st
import streamlit.components.v1 as components
import time

# -------------------------------------------------
# Page config
# -------------------------------------------------
st.set_page_config(
    page_title="Lexora - Create Account",
    page_icon="⚖️",
    layout="centered",
    initial_sidebar_state="collapsed"
)

# -------------------------------------------------
# Custom CSS styling
# -------------------------------------------------
st.markdown("""
<style>
/* Hide Streamlit elements */
#MainMenu {visibility: hidden;}
footer {visibility: hidden;}
header {visibility: hidden;}
section[data-testid="stSidebar"] {display: none;}

/* Import fonts */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&display=swap');

/* Main container styling */
.stApp {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

/* Center the content */
.main .block-container {
    max-width: 450px;
    padding-top: 2rem;
    padding-bottom: 2rem;
}

/* Logo styling */
.lexora-logo {
    font-family: 'Cinzel', serif;
    font-size: 2.5rem;
    font-weight: 700;
    color: white;
    text-align: center;
    margin-bottom: 2rem;
    letter-spacing: 3px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

/* Login container */
.login-container {
    background: white;
    border-radius: 20px;
    padding: 3rem 2rem;
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    margin: 2rem auto;
}

.login-title {
    font-family: 'Poppins', sans-serif;
    font-size: 1.8rem;
    font-weight: 600;
    color: #333;
    text-align: center;
    margin-bottom: 0.5rem;
}

.tagline {
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    color: #666;
    text-align: center;
    margin-bottom: 2rem;
}

/* Google button styling */
.google-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 12px 20px;
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    font-weight: 500;
    color: #333;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 1.5rem;
}

.google-button:hover {
    background: #f8f8f8;
    border-color: #4285F4;
    box-shadow: 0 2px 8px rgba(66, 133, 244, 0.2);
}

/* Divider styling */
.divider {
    text-align: center;
    margin: 1.5rem 0;
    position: relative;
    color: #999;
    font-family: 'Poppins', sans-serif;
}

.divider:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    width: 45%;
    height: 1px;
    background: #e0e0e0;
}

.divider:after {
    content: '';
    position: absolute;
    right: 0;
    top: 50%;
    width: 45%;
    height: 1px;
    background: #e0e0e0;
}

/* Input field styling */
.stTextInput > div > div > input {
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    padding: 12px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    transition: border-color 0.3s ease;
}

.stTextInput > div > div > input:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
}

/* Continue button styling */
.stButton > button {
    width: 100%;
    padding: 12px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.3s ease;
}

.stButton > button:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
}

/* Footer links */
.footer-links {
    text-align: center;
    margin-top: 2rem;
    font-family: 'Poppins', sans-serif;
    font-size: 0.9rem;
}

.footer-links a {
    color: white;
    text-decoration: none;
    opacity: 0.8;
    transition: opacity 0.3s ease;
}

.footer-links a:hover {
    opacity: 1;
}

.separator {
    color: white;
    opacity: 0.5;
    margin: 0 1rem;
}

/* Success message */
.success-message {
    background: #4CAF50;
    color: white;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
    font-family: 'Poppins', sans-serif;
    margin-bottom: 1rem;
}

/* Error message */
.error-message {
    background: #f44336;
    color: white;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
    font-family: 'Poppins', sans-serif;
    margin-bottom: 1rem;
}
</style>
""", unsafe_allow_html=True)

# -------------------------------------------------
# Initialize session state
# -------------------------------------------------
if 'signup_email' not in st.session_state:
    st.session_state.signup_email = ""
if 'account_created' not in st.session_state:
    st.session_state.account_created = False
if 'show_success' not in st.session_state:
    st.session_state.show_success = False

# -------------------------------------------------
# Header with logo
# -------------------------------------------------
st.markdown('<div class="lexora-logo">LEXORA</div>', unsafe_allow_html=True)

# -------------------------------------------------
# Account Creation container
# -------------------------------------------------
st.markdown('<div class="login-container">', unsafe_allow_html=True)
st.markdown('<h2 class="login-title">Log in or sign up</h2>', unsafe_allow_html=True)
st.markdown('<p class="tagline">Your Legal Companion</p>', unsafe_allow_html=True)

# Success message and redirect
if st.session_state.show_success:
    st.markdown('<div class="success-message">✅ Account created successfully! Redirecting...</div>', unsafe_allow_html=True)
    time.sleep(2)
    # Clear the success flag
    st.session_state.show_success = False
    # Redirect back to landing page
    st.markdown("""
        <meta http-equiv="refresh" content="0; url=/">
    """, unsafe_allow_html=True)

# -------------------------------------------------
# Google OAuth button (placeholder)
# -------------------------------------------------
google_html = """
<button class="google-button" style="width: 100%; display: flex; align-items: center; justify-content: center;">
    <svg style="margin-right: 10px;" width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
        <path d="M19.8 10.2c0-.7-.1-1.4-.2-2H10v3.7h5.5c-.2 1.2-.9 2.3-2 3v2.5h3.2c1.9-1.7 3-4.3 3-7.2z" fill="#4285F4"/>
        <path d="M10 20c2.7 0 5-0.9 6.6-2.4l-3.2-2.5c-.9.6-2 1-3.4 1-2.6 0-4.8-1.8-5.6-4.2H1.1v2.6C2.7 17.8 6.1 20 10 20z" fill="#34A853"/>
        <path d="M4.4 11.9c-.2-.6-.3-1.2-.3-1.9s.1-1.3.3-1.9V5.5H1.1C.4 6.9 0 8.4 0 10s.4 3.1 1.1 4.5l3.3-2.6z" fill="#FBBC05"/>
        <path d="M10 3.9c1.5 0 2.8.5 3.8 1.5l2.8-2.8C15 1 12.7 0 10 0 6.1 0 2.7 2.2 1.1 5.5l3.3 2.6C5.2 5.7 7.4 3.9 10 3.9z" fill="#EA4335"/>
    </svg>
    <span>Continue with Google</span>
</button>
"""
st.markdown(google_html, unsafe_allow_html=True)

# Placeholder for Google OAuth
if st.button("", key="google_hidden", help="Google OAuth", label_visibility="collapsed", type="secondary"):
    pass

# -------------------------------------------------
# Divider
# -------------------------------------------------
st.markdown('<div class="divider">or</div>', unsafe_allow_html=True)

# -------------------------------------------------
# Email signup form
# -------------------------------------------------
with st.form("signup_form"):
    email = st.text_input(
        "Email",
        placeholder="Email address",
        value=st.session_state.signup_email,
        label_visibility="collapsed"
    )
    
    submitted = st.form_submit_button("Continue", use_container_width=True)
    
    if submitted:
        if email:
            # Validate email format
            import re
            email_pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
            
            if re.match(email_pattern, email):
                st.session_state.signup_email = email
                st.session_state.account_created = True
                st.session_state.show_success = True
                st.rerun()
            else:
                st.markdown('<div class="error-message">❌ Please enter a valid email address</div>', unsafe_allow_html=True)
        else:
            st.markdown('<div class="error-message">❌ Please enter your email address</div>', unsafe_allow_html=True)

st.markdown('</div>', unsafe_allow_html=True)

# -------------------------------------------------
# Footer
# -------------------------------------------------
st.markdown("""
<div class="footer-links">
    <a href="#" onclick="alert('Terms of Use page would open here'); return false;">Terms of Use</a>
    <span class="separator">|</span>
    <a href="#" onclick="alert('Privacy Policy page would open here'); return false;">Privacy Policy</a>
</div>
""", unsafe_allow_html=True)